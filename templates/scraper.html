<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Scraper | LinkedIn Jobs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    
    .form-input {
      transition: all 0.2s ease;
      border: 2px solid #e5e7eb;
    }
    .form-input:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }
    
    .progress-bar {
      transition: width 0.3s ease;
      background: linear-gradient(90deg, #10b981, #059669);
    }
    
    .status-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
    }
    
    .success-card {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border: 1px solid #10b981;
    }
    
    .error-card {
      background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
      border: 1px solid #ef4444;
    }
    
    .pulse-dot {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .floating-card {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }
    
    .tooltip {
      position: relative;
    }
    
    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 6px 8px;
      border-radius: 4px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      z-index: 100;
    }
    
    .tooltip:hover::after {
      opacity: 1;
    }
    
    .gradient-button {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      transition: all 0.2s ease;
    }
    
    .gradient-button:hover {
      background: linear-gradient(135deg, #5855eb 0%, #7c3aed 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }
  </style>
</head>
<body class="bg-gray-100">
  <div class="flex min-h-screen">
    <!-- Sidebar - Fixed -->
    <aside class="fixed left-0 top-0 h-full w-64 bg-gray-900 text-gray-100 flex flex-col p-6 space-y-6 z-40 overflow-y-auto">
      <div class="flex items-center gap-2 text-xl font-semibold">
        <i data-lucide="briefcase" class="w-5 h-5"></i>
        <span>Job Portal</span>
      </div>
      <nav class="flex flex-col space-y-2 text-sm font-medium">
        <a href="/marketplace" class="flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-800">
          <i data-lucide="layout-list" class="w-4 h-4"></i> Marketplace Jobs
        </a>
        <a href="#" class="flex items-center gap-2 px-3 py-2 rounded bg-gray-800">
          <i data-lucide="search" class="w-4 h-4"></i> Scraper
        </a>
      </nav>
      
      <!-- Tips Section -->
      <!-- <div class="mt-8 pt-6 border-t border-gray-700">
        <h3 class="text-sm font-semibold text-gray-300 mb-3">ðŸ’¡ Pro Tips</h3>
        <ul class="space-y-2 text-xs text-gray-400">
          <li>â€¢ Use specific job titles for better results</li>
          <li>â€¢ Try "Remote" for location to find remote jobs</li>
          <li>â€¢ Larger limits take more time but provide more data</li>
          <li>â€¢ Enhanced scraper extracts skills and salary info</li>
        </ul>
      </div> -->
    </aside>

    <!-- Main content - Scrollable with left margin to account for fixed sidebar -->
    <main class="flex-1 ml-64 h-screen overflow-y-auto">
      <div class="p-10 bg-gray-50">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
              <i data-lucide="search" class="w-8 h-8 text-indigo-600"></i> 
              LinkedIn Job Scraper
            </h1>
            <p class="text-gray-600 mt-2">Extract comprehensive job data with enhanced accuracy and detailed information</p>
          </div>
          
          <!-- Status Indicator -->
          <div class="flex items-center gap-2 text-sm">
            <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
            <span class="text-gray-600">System Ready</span>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          <!-- Scraper Form -->
          <div class="lg:col-span-2">
            <div class="floating-card bg-white rounded-2xl shadow-lg p-8 border border-gray-200">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-gray-900">Configure Scraper</h2>
                <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-medium">Enhanced Mode</span>
              </div>
              
              <form id="scrapeForm" class="space-y-6">
                <!-- Basic Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                      <i data-lucide="search" class="w-4 h-4 inline mr-1"></i>
                      Job Keywords
                    </label>
                    <input 
                      type="text" 
                      name="keywords" 
                      required 
                      class="form-input w-full rounded-lg px-4 py-3"
                      placeholder="e.g. Python Developer, Data Scientist"
                      autocomplete="off"
                    >
                    <p class="text-xs text-gray-500 mt-1">Specific job titles work best</p>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                      <i data-lucide="map-pin" class="w-4 h-4 inline mr-1"></i>
                      Location
                    </label>
                    <input 
                      type="text" 
                      name="location" 
                      required 
                      class="form-input w-full rounded-lg px-4 py-3"
                      placeholder="e.g. Bengaluru, India or Remote"
                      autocomplete="off"
                    >
                    <p class="text-xs text-gray-500 mt-1">City, country, or "Remote"</p>
                  </div>
                </div>

                <!-- Advanced Options -->
                <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                  <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i data-lucide="settings" class="w-5 h-5 mr-2"></i>
                    Advanced Options
                  </h3>
                  
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">
                        Job Limit
                        <span class="tooltip" data-tooltip="More jobs = longer scraping time">
                          <i data-lucide="help-circle" class="w-3 h-3 inline ml-1 text-gray-400"></i>
                        </span>
                      </label>
                      <select name="limit" class="form-input w-full rounded-lg px-3 py-2">
                        <option value="10">10 jobs (Quick)</option>
                        <option value="25" selected>25 jobs (Recommended)</option>
                        <option value="50">50 jobs (Detailed)</option>
                        <option value="100">100 jobs (Comprehensive)</option>
                      </select>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Experience Level</label>
                      <select name="experience" class="form-input w-full rounded-lg px-3 py-2">
                        <option value="">Any Level</option>
                        <option value="internship">Internship</option>
                        <option value="entry_level">Entry Level</option>
                        <option value="associate">Associate</option>
                        <option value="mid_senior">Mid-Senior</option>
                        <option value="director">Director</option>
                        <option value="executive">Executive</option>
                      </select>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-gray-700 mb-2">Job Type</label>
                      <select name="job_type" class="form-input w-full rounded-lg px-3 py-2">
                        <option value="">Any Type</option>
                        <option value="full_time">Full-time</option>
                        <option value="part_time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="temporary">Temporary</option>
                        <option value="volunteer">Volunteer</option>
                        <option value="internship">Internship</option>
                      </select>
                    </div>
                  </div>
                  
                  <!-- Scraper Settings -->
                  <div class="mt-6 pt-6 border-t border-gray-200">
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Scraper Settings</h4>
                    <div class="flex flex-wrap gap-6">
                      <label class="flex items-center">
                        <input type="checkbox" name="headless" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm text-gray-700">Headless Mode (Faster)</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" name="fast" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm text-gray-700">Fast Mode (Less Human-like)</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Submit Button -->
                <button 
                  type="submit" 
                  id="submitBtn"
                  class="gradient-button w-full text-white font-semibold py-4 px-6 rounded-xl transition duration-200 flex items-center justify-center space-x-3 shadow-lg"
                >
                  <i data-lucide="rocket" class="w-5 h-5"></i>
                  <span>Start Enhanced Scraping</span>
                </button>
              </form>
            </div>
          </div>

          <!-- Status Panel -->
          <div class="space-y-6">
            
            <!-- Current Status -->
            <div id="statusPanel" class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200 hidden">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Scraping Progress</h3>
                <button onclick="cancelJob()" class="text-red-600 hover:text-red-800 text-sm font-medium">
                  Cancel
                </button>
              </div>
              
              <!-- Progress Bar -->
              <div class="mb-6">
                <div class="flex items-center justify-between text-sm text-gray-700 mb-2">
                  <span>Progress</span>
                  <span id="progressText">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                  <div id="progressBar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
                </div>
              </div>
              
              <!-- Status Message -->
              <div id="currentStatus" class="status-card rounded-lg p-4 mb-4">
                <div class="flex items-center space-x-3">
                  <div class="pulse-dot w-3 h-3 bg-indigo-600 rounded-full"></div>
                  <span id="statusMessage" class="text-sm font-medium text-gray-700">Initializing...</span>
                </div>
              </div>
              
              <!-- Job Details -->
              <div class="text-sm text-gray-600 space-y-1">
                <p><span class="font-medium">Job ID:</span> <span id="jobId" class="font-mono">--</span></p>
                <p><span class="font-medium">Keywords:</span> <span id="jobKeywords">--</span></p>
                <p><span class="font-medium">Location:</span> <span id="jobLocation">--</span></p>
                <p><span class="font-medium">Started:</span> <span id="jobStartTime">--</span></p>
              </div>
            </div>

            <!-- Results Panel -->
            <div id="resultsPanel" class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200 hidden">
              <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                  <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Scraping Complete!</h3>
              </div>
              
              <!-- Enhanced Results Summary -->
              <div id="resultsSummary" class="success-card rounded-lg p-4 mb-4">
                <div class="grid grid-cols-2 gap-4 text-center">
                  <div>
                    <div class="text-2xl font-bold text-green-600" id="totalJobsFound">0</div>
                    <div class="text-xs text-gray-600">Jobs Found</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-blue-600" id="jobsWithSkills">0</div>
                    <div class="text-xs text-gray-600">With Skills</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-purple-600" id="companiesFound">0</div>
                    <div class="text-xs text-gray-600">Companies</div>
                  </div>
                  <div>
                    <div class="text-2xl font-bold text-orange-600" id="jobsWithSalary">0</div>
                    <div class="text-xs text-gray-600">With Salary</div>
                  </div>
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div class="space-y-3">
                <button 
                  onclick="viewResults()" 
                  class="w-full bg-indigo-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-indigo-700 transition flex items-center justify-center space-x-2"
                >
                  <i data-lucide="eye" class="w-4 h-4"></i>
                  <span>View Jobs in Marketplace</span>
                </button>
                
                <div class="grid grid-cols-2 gap-3">
                  <button 
                    onclick="downloadCSV()" 
                    class="bg-green-600 text-white font-medium py-2 px-3 rounded-lg hover:bg-green-700 transition flex items-center justify-center space-x-1 text-sm"
                  >
                    <i data-lucide="download" class="w-4 h-4"></i>
                    <span>CSV</span>
                  </button>
                  <button 
                    onclick="downloadExcel()" 
                    class="bg-blue-600 text-white font-medium py-2 px-3 rounded-lg hover:bg-blue-700 transition flex items-center justify-center space-x-1 text-sm"
                  >
                    <i data-lucide="file-spreadsheet" class="w-4 h-4"></i>
                    <span>Excel</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Error Panel -->
            <div id="errorPanel" class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200 hidden">
              <div class="flex items-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                  <i data-lucide="alert-circle" class="w-4 h-4 text-red-600"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900">Scraping Failed</h3>
              </div>
              
              <div class="error-card rounded-lg p-4 mb-4">
                <p id="errorMessage" class="text-sm text-red-700"></p>
              </div>
              
              <button 
                onclick="resetForm()" 
                class="w-full bg-gray-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-gray-700 transition"
              >
                Try Again
              </button>
            </div>

            <!-- Info Panel -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="info" class="w-5 h-5 mr-2 text-blue-500"></i>
                Enhanced Features
              </h3>
              <ul class="space-y-2 text-sm text-gray-700">
                <li class="flex items-start space-x-2">
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                  <span>Automatic skill extraction from job descriptions</span>
                </li>
                <li class="flex items-start space-x-2">
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                  <span>Salary range detection and parsing</span>
                </li>
                <li class="flex items-start space-x-2">
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                  <span>Company information and logos</span>
                </li>
                <li class="flex items-start space-x-2">
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                  <span>Applicant count when available</span>
                </li>
                <li class="flex items-start space-x-2">
                  <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"></i>
                  <span>Anti-detection measures for reliability</span>
                </li>
              </ul>
            </div>

            <!-- Recent Activity -->
            <div id="recentActivity" class="bg-white rounded-2xl shadow-lg p-6 border border-gray-200">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i data-lucide="clock" class="w-5 h-5 mr-2"></i>
                Recent Scrapes
              </h3>
              <div id="recentList" class="space-y-3">
                <p class="text-sm text-gray-500 text-center py-4">No recent scrapes</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast Notifications -->
  <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

  <script>
    lucide.createIcons();
    
    let currentJobId = null;
    let pollInterval = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      loadRecentActivity();
      setupFormValidation();
    });

    // Form submission
    document.getElementById('scrapeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      // Convert checkboxes to booleans
      data.headless = formData.has('headless');
      data.fast = formData.has('fast');
      
      try {
        showStatusPanel();
        updateSubmitButton(true);
        
        const response = await fetch('/api/scrape', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (!result.success) {
          throw new Error(result.error || 'Failed to start scraping');
        }
        
        currentJobId = result.job_id;
        updateJobDetails(data, currentJobId);
        startPolling();
        saveToRecentActivity(data, currentJobId);
        showToast('Scraping job started successfully!', 'success');
        
      } catch (error) {
        console.error('Error starting scrape:', error);
        showErrorPanel(error.message);
        showToast('Failed to start scraping', 'error');
        updateSubmitButton(false);
      }
    });

    function showStatusPanel() {
      document.getElementById('statusPanel').classList.remove('hidden');
      document.getElementById('resultsPanel').classList.add('hidden');
      document.getElementById('errorPanel').classList.add('hidden');
      
      // Reset progress
      updateProgress(0, 'Initializing enhanced scraper...');
    }

    function showResultsPanel(results) {
      document.getElementById('statusPanel').classList.add('hidden');
      document.getElementById('resultsPanel').classList.remove('hidden');
      document.getElementById('errorPanel').classList.add('hidden');
      
      // Update results with enhanced data
      const quality = results.quality_stats || {};
      document.getElementById('totalJobsFound').textContent = quality.total_jobs || 0;
      document.getElementById('jobsWithSkills').textContent = quality.jobs_with_skills || 0;
      document.getElementById('companiesFound').textContent = quality.companies || 0;
      document.getElementById('jobsWithSalary').textContent = quality.jobs_with_salary || 0;
      
      updateSubmitButton(false);
    }

    function showErrorPanel(message) {
      document.getElementById('statusPanel').classList.add('hidden');
      document.getElementById('resultsPanel').classList.add('hidden');
      document.getElementById('errorPanel').classList.remove('hidden');
      
      document.getElementById('errorMessage').textContent = message;
      updateSubmitButton(false);
    }

    function updateJobDetails(data, jobId) {
      document.getElementById('jobId').textContent = jobId;
      document.getElementById('jobKeywords').textContent = data.keywords;
      document.getElementById('jobLocation').textContent = data.location;
      document.getElementById('jobStartTime').textContent = new Date().toLocaleTimeString();
    }

    function updateProgress(percent, message) {
      document.getElementById('progressBar').style.width = `${percent}%`;
      document.getElementById('progressText').textContent = `${percent}%`;
      document.getElementById('statusMessage').textContent = message;
    }

    function updateSubmitButton(loading) {
      const btn = document.getElementById('submitBtn');
      if (loading) {
        btn.disabled = true;
        btn.innerHTML = `
          <div class="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"></div>
          <span>Scraping in Progress...</span>
        `;
      } else {
        btn.disabled = false;
        btn.innerHTML = `
          <i data-lucide="rocket" class="w-5 h-5"></i>
          <span>Start Enhanced Scraping</span>
        `;
        lucide.createIcons();
      }
    }

    async function startPolling() {
      if (!currentJobId) return;
      
      pollInterval = setInterval(async () => {
        try {
          const response = await fetch(`/api/status/${currentJobId}`);
          const data = await response.json();
          
          if (!data.success) {
            throw new Error('Failed to get job status');
          }
          
          const status = data.status;
          updateProgress(status.progress || 0, status.message || 'Processing...');
          
          if (status.status === 'completed') {
            clearInterval(pollInterval);
            showResultsPanel(status);
            showToast('Scraping completed successfully!', 'success');
            loadRecentActivity();
            
            // Notification sound (if supported)
            if ('Notification' in window && Notification.permission === 'granted') {
              new Notification('Job Scraping Complete!', {
                body: `Found ${status.quality_stats?.total_jobs || 0} jobs`,
                icon: '/favicon.ico'
              });
            }
            
          } else if (status.status === 'error') {
            clearInterval(pollInterval);
            showErrorPanel(status.message || 'Scraping failed');
            showToast('Scraping failed', 'error');
          }
          
        } catch (error) {
          console.error('Error polling status:', error);
          clearInterval(pollInterval);
          showErrorPanel('Lost connection to scraper');
        }
      }, 2000);
    }

    function cancelJob() {
      if (pollInterval) {
        clearInterval(pollInterval);
        pollInterval = null;
      }
      currentJobId = null;
      resetForm();
      showToast('Scraping cancelled', 'info');
    }

    function resetForm() {
      document.getElementById('statusPanel').classList.add('hidden');
      document.getElementById('resultsPanel').classList.add('hidden');
      document.getElementById('errorPanel').classList.add('hidden');
      
      if (pollInterval) {
        clearInterval(pollInterval);
        pollInterval = null;
      }
      currentJobId = null;
      updateSubmitButton(false);
    }

    function viewResults() {
      window.location.href = '/marketplace';
    }

    async function downloadCSV() {
      if (!currentJobId) return;
      
      try {
        const response = await fetch(`/api/export/csv/${currentJobId}`);
        const data = await response.json();
        
        if (data.success) {
          window.open(data.file_url, '_blank');
          showToast('CSV downloaded successfully!', 'success');
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        showToast('Failed to download CSV', 'error');
      }
    }

    async function downloadExcel() {
      if (!currentJobId) return;
      
      try {
        const response = await fetch(`/api/export/excel/${currentJobId}`);
        const data = await response.json();
        
        if (data.success) {
          window.open(data.file_url, '_blank');
          showToast('Excel file downloaded successfully!', 'success');
        } else {
          throw new Error(data.error);
        }
      } catch (error) {
        showToast('Failed to download Excel file', 'error');
      }
    }

    function saveToRecentActivity(data, jobId) {
      const recent = JSON.parse(localStorage.getItem('recentScrapes') || '[]');
      recent.unshift({
        id: jobId,
        keywords: data.keywords,
        location: data.location,
        limit: data.limit,
        timestamp: new Date().toISOString()
      });
      
      // Keep only last 5
      if (recent.length > 5) {
        recent.splice(5);
      }
      
      localStorage.setItem('recentScrapes', JSON.stringify(recent));
      loadRecentActivity();
    }

    function loadRecentActivity() {
      const recent = JSON.parse(localStorage.getItem('recentScrapes') || '[]');
      const container = document.getElementById('recentList');
      
      if (recent.length === 0) {
        container.innerHTML = '<p class="text-sm text-gray-500 text-center py-4">No recent scrapes</p>';
        return;
      }
      
      container.innerHTML = recent.map(scrape => `
        <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
          <div class="font-medium text-gray-900 text-sm">${scrape.keywords}</div>
          <div class="text-gray-600 text-xs">${scrape.location} â€¢ ${scrape.limit} jobs</div>
          <div class="text-gray-500 text-xs mt-1">${getTimeAgo(scrape.timestamp)}</div>
        </div>
      `).join('');
    }

    function setupFormValidation() {
      const form = document.getElementById('scrapeForm');
      const inputs = form.querySelectorAll('input[required]');
      
      inputs.forEach(input => {
        input.addEventListener('blur', function() {
          if (!this.value.trim()) {
            this.classList.add('border-red-300');
          } else {
            this.classList.remove('border-red-300');
          }
        });
        
        input.addEventListener('input', function() {
          this.classList.remove('border-red-300');
        });
      });
    }

    function getTimeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffMins = Math.floor(diffTime / (1000 * 60));
      const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
      
      if (diffMins < 60) {
        return `${diffMins} min ago`;
      } else if (diffHours < 24) {
        return `${diffHours}h ago`;
      } else {
        return date.toLocaleDateString();
      }
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const icons = {
        success: 'check-circle',
        error: 'alert-circle',
        info: 'info'
      };
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500'
      };
      
      toast.className = `${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg text-sm font-medium transform translate-x-0 transition-all duration-300 flex items-center space-x-2`;
      toast.innerHTML = `
        <i data-lucide="${icons[type]}" class="w-4 h-4"></i>
        <span>${message}</span>
      `;
      
      document.getElementById('toastContainer').appendChild(toast);
      lucide.createIcons();
      
      setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // Auto-focus first input on page load
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('input[name="keywords"]').focus();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        if (!document.getElementById('submitBtn').disabled) {
          document.getElementById('scrapeForm').dispatchEvent(new Event('submit'));
        }
      }
    });

    // Request notification permission
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }
  </script>
</body>
</html>